(()=>{"use strict";class e{constructor(e,t,n){this._id=e,this._name=t,this._wings=n}name(){return this._name}}class t{constructor(e){this._mediator=e}build(){let t=document.createElement("form"),n=document.createElement("input"),o=document.createElement("button");return o.innerHTML="Войти",t.addEventListener("submit",(t=>{t.preventDefault();let o=new e(1,n.value,0);return this._mediator.setPlayer(o),this._mediator.handleEvent("auth"),!1})),t.appendChild(n),t.appendChild(o),t}}class n{constructor(e,t,n){this._url=e,this._socket=t,this._playerName=n,this.pong()}send(e){1===this._socket.readyState&&this._socket.send(e)}pong(){console.log("pong"),console.log(this._socket),console.log(this),this._socket?0!==this._socket.readyState?1===this._socket.readyState?this._socket.send("heartbeat: "+this._playerName):console.log("err 2",this._socket):setTimeout(this.pong,1e3):console.log("err 1",this._socket)}}class o{constructor(e){this._container=e,this._webSocketAddress=this._container.getAttribute("ws-server")}handleEvent(e){return o=this,s=void 0,r=function*(){if("start"===e){let e=new t(this);this._container.appendChild(e.build())}if("auth"===e){let e=yield(o=this._webSocketAddress,new Promise((function(e,t){var n=new WebSocket(o);n.onclose=function(e){e.wasClean?console.log("Соединение закрыто чисто"):console.log("Обрыв соединения"),console.log("Код: "+e.code+" причина: "+e.reason),console.log(e)},n.onmessage=function(e){console.log("Получены данные "+e.data)},n.onerror=function(e){console.log(e)},n.onopen=function(){e(n)},n.onerror=function(e){t(e)}})));new n(this._webSocketAddress,e,this._player.name()).send("message")}var o},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,c)}a((r=r.apply(o,s||[])).next())}));var o,s,i,r}setPlayer(e){this._player=e}}window.addEventListener("load",(()=>new class{constructor(e){this._selector=e}run(){return e=this,t=void 0,s=function*(){this._container=document.querySelector(this._selector),new o(this._container).handleEvent("start")},new((n=void 0)||(n=Promise))((function(o,i){function r(e){try{a(s.next(e))}catch(e){i(e)}}function c(e){try{a(s.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((s=s.apply(e,t||[])).next())}));var e,t,n,s}}("#app").run()))})();
//# sourceMappingURL=app.js.map