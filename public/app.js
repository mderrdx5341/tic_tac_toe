(()=>{"use strict";class e{constructor(e,t,n,s){this._id=e,this._name=t,this._wins=n,this._status=s}name(){return this._name}wins(){return this._wins}status(){return this._status}}class t{constructor(e){this._mediator=e}build(){let t=document.createElement("form"),n=document.createElement("input"),s=document.createElement("button");return s.innerHTML="Войти",t.addEventListener("submit",(t=>{t.preventDefault();let s=new e(1,n.value,0,"fff");return this._mediator.setPlayer(s),this._mediator.handleEvent("auth"),!1})),t.appendChild(n),t.appendChild(s),t}}class n{constructor(e,t,n){this._url=e,this._socket=t,this._playerName=n,this.pong()}setMessageHandler(e){this._socket.onmessage=e}send(e){1===this._socket.readyState&&this._socket.send(e)}pong(){this._socket?0!==this._socket.readyState?1===this._socket.readyState?(this._socket.send("heartbeat: "+this._playerName),setTimeout((()=>this.pong()),3e4)):console.log("err 2",this._socket):setTimeout(this.pong,1e3):console.log("err 1",this._socket)}}class s{constructor(e){this._players=e}build(){let e=document.createElement("div"),t=document.createElement("ul");for(let e=0;e<this._players.length;e++){let n=document.createElement("li");console.log(this._players),n.innerHTML=`${this._players[e].name()}, wins: ${this._players[e].wins()}, status: ${this._players[e].status()}`,t.appendChild(n)}return e.appendChild(t),e}}let o={Players:class{constructor(e,t){this._mediator=e,this._webSocketClient=t}auth(e){console.log(e,"auth"),e.ok}players(t){if(console.log(t,"players"),!this.isObject(t.playersData))return;let n=[];for(let s in t.playersData)n.push(new e(0,t.playersData[s].name,t.playersData[s].wins,t.playersData[s].status));let o=new s(n);this._mediator.container().appendChild(o.build())}isObject(e){return null!==e&&"object"==typeof e}},Game:class{}};class a{constructor(e){this._container=e,this._webSocketAddress=this._container.getAttribute("ws-server")}handleEvent(e){return s=this,o=void 0,i=function*(){if("start"===e){let e=new t(this);this._container.appendChild(e.build())}if("auth"===e){let e=yield(s=this._webSocketAddress,new Promise((function(e,t){var n=new WebSocket(s);n.onclose=function(e){e.wasClean?console.log("Соединение закрыто чисто"):console.log("Обрыв соединения"),console.log("Код: "+e.code+" причина: "+e.reason),console.log(e)},n.onmessage=function(e){console.log("Получены данные "+e.data)},n.onerror=function(e){console.log(e)},n.onopen=function(){e(n)},n.onerror=function(e){t(e)}})));this._webSocketClient=new n(this._webSocketAddress,e,this._player.name()),this._webSocketClient.setMessageHandler(this.MessageHandler.bind(this)),this._webSocketClient.send(`{"controller": "Players", "action": "auth", "data":"${this._player.name()}"}`)}var s;"players"===e&&this._webSocketClient.send('{"controller": "Players", "action":"getPlayers", "data": ""}')},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(i.next(e))}catch(e){t(e)}}function r(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(n,r)}l((i=i.apply(s,o||[])).next())}));var s,o,a,i}MessageHandler(e){let t=JSON.parse(e.data);new o[t.controller](this,this._webSocketClient)[t.action](t.args)}webSocketClient(){this._webSocketClient}container(){return this._container}setPlayer(e){this._player=e}}window.addEventListener("load",(()=>new class{constructor(e){this._selector=e}run(){return e=this,t=void 0,s=function*(){this._container=document.querySelector(this._selector),new a(this._container).handleEvent("start")},new((n=void 0)||(n=Promise))((function(o,a){function i(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}l((s=s.apply(e,t||[])).next())}));var e,t,n,s}}("#app").run()))})();
//# sourceMappingURL=app.js.map